##### Разработка Sayfullin R.R.
##### Django, Celery и Redis: гайд по работе с асинхронными задачами

Инструкция актуальна для Linux-систем.
========================================================================================================================
Используемые технологии:
    python~=3.9
    Django~=4.1
    celery>=5.2.7
    PostgreSQL

Скопируйте репозиторий с помощью команды:
$ git clone https://github.com/RuslanSayfullin/django_celery.git
Перейдите в основную директорию с помощью команды: 
$ cd django_celery

Создать и активировать виртуальное окружение:
========================================================================================================================
$ poetry env use python3.9
Установить зависимости:
$ poetry install 
Сохранить, адрес созданного виртуального окружения из вывода(рекомендуется)
$ poetry shell
(web-py3.9) $
Выход:
$ exit

Добавить в директорию web/portal файл psw.py
========================================================================================================================
В данный файл, необходимо добавить две переменные:

secret_key = 'ваш секретный ключ'   # секретный ключ приложения
dbase_psw = 'ваш ключ к БД'         # Пароль для подключения к БД

Создание БД
========================================================================================================================
$ sudo su - postgres
Теперь запускаем командную оболочку PostgreSQL:
$ psql 

=# CREATE DATABASE celery;
=# CREATE USER portaluser WITH PASSWORD 'myPassword';
=# GRANT ALL PRIVILEGES ON DATABASE celery TO portaluser;
=# \q
$ exit

Перейти в директорию reckoning
========================================================================================================================
установите Redis в своей системе:
$ sudo apt update
$ sudo apt install redis

После завершения установки вы можете запустить сервер Redis, чтобы убедиться, что все работает.
Откройте новое окно терминала, чтобы запустить сервер:
$ redis-server

Чтобы проверить, работает ли связь с сервером Redis, запустите интерфейс командной строки Redis в новом окне терминала:
$ redis-cli

Как только приглашение изменилось, вы можете ввести ping и нажать Enter, а затем дождаться ответа от Redis:
127.0.0.1:6379> ping
PONG
127.0.0.1:6379>

Далее вам понадобится клиент Python для взаимодействия с Redis.
(web-py3.9)  $ poetry add redis
Эта команда не устанавливает Redis в системе, а только предоставляет интерфейс Python для подключения к Redis.


========================================================================================================================

Для запуска выполнить следующие команды:
Команда для создания миграций приложения для базы данных
$ python3 manage.py makemigrations
$ python3 manage.py migrate

Создание суперпользователя
$ python3 manage.py createsuperuser

Будут выведены следующие выходные данные. Введите требуемое имя пользователя, электронную почту и пароль:
по умолчанию почта admin@admin.com пароль: 12345

Username (leave blank to use 'admin'): admin
Email address: admin@admin.com
Password: ********
Password (again): ********
Superuser created successfully.

Команды для запуска приложения:
$ python3 manage.py runserver


Django-приложение будет доступно по адресу: http://127.0.0.1:8000/

Запуск приложения
========================================================================================================================
Откройте три отдельных окна терминала и запустите все программы.

Отправьте свое веб-приложение на сервер разработки Django в первом окне:
(web-py3.9) $ python3 manage.py runserver

Затем запустите сервер Redis во втором окне терминала, если вы остановили его ранее:
$ redis-server

Наконец, теперь вы можете правильно запускать Celery, не сталкиваясь с сообщением об ошибке:
(web-py3.9) $ python3 -m celery -A django_celery worker

*Примечание
Вы можете увидеть предупреждение, связанное с DEBUG настройкой Django. Вы можете проигнорировать это предупреждение для 
этого примера, но вы всегда должны устанавливать DEBUFalse перед развертыванием сайта в рабочей среде.

Источники
========================================================================================================================
https://realpython.com/asynchronous-tasks-with-django-and-celery/
https://realpython.com/asynchronous-tasks-with-django-and-celery/